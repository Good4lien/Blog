var grp={jQuery:jQuery.noConflict(!0)},django={jQuery:grp.jQuery},jQuery=grp.jQuery,inputTypes=["[type='search']","[type='email']","[type='url']","[type='tel']","[type='number']","[type='range']","[type='date']","[type='month']","[type='week']","[type='time']","[type='datetime']","[type='datetime-local']","[type='color']"].join(",");!function(a){grappelli.getFormat=function(e){if("date"==e)return DATE_FORMAT.toLowerCase().replace(/%\w/g,function(e){return(e=e.replace(/%/,""))+e})},grappelli.cleanInputTypes=function(){a("form").each(function(){a(this).find(":input").filter(inputTypes).each(function(){a(this).attr("type","text")})})},grappelli.initDateAndTimePicker=function(){a("p.datetime").each(function(){var e=a(this).html();e=(e=e.replace(/\w*: /,"")).replace(/<br>[^<]*: /g,"<br>"),a(this).html(e)});var e={constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date"),showButtonPanel:!0,showAnim:"",beforeShow:function(e,t,a){grappelli.datepicker_instance=this}},t=a("input[class*='vDateField']:not([id*='__prefix__'])");t.datepicker(e),"undefined"!=typeof IS_POPUP&&IS_POPUP&&t.datepicker("disable"),a(document).on("click",".ui-datepicker-current",function(){a.datepicker._selectDate(grappelli.datepicker_instance),grappelli.datepicker_instance=null}),a("input[class*='vTimeField']:not([id*='__prefix__'])").grp_timepicker()},grappelli.initFilter=function(){a("a.grp-pulldown-handler").click(function(){var e=a(this).closest(".grp-pulldown-container");a(e).toggleClass("grp-pulldown-state-open").children(".grp-pulldown-content").toggle()}),a("a.grp-pulldown-handler").bind("mouseout",function(){a(this).blur()}),a(".grp-filter-choice").change(function(){location.href=a(this).val()})},grappelli.initSearchbar=function(){a("input.grp-search-field").focus()},grappelli.updateSelectFilter=function(e){"undefined"!=typeof SelectFilter&&(e.find(".selectfilter").each(function(e,t){var a=t.name.split("-");SelectFilter.init(t.id,a[a.length-1],!1,"{% admin_media_prefix %}")}),e.find(".selectfilterstacked").each(function(e,t){var a=t.name.split("-");SelectFilter.init(t.id,a[a.length-1],!0,"{% admin_media_prefix %}")}))},grappelli.reinitDateTimeFields=function(e){e.find(".vDateField").datepicker({constrainInput:!1,showOn:"button",buttonImageOnly:!1,buttonText:"",dateFormat:grappelli.getFormat("date")}),e.find(".vTimeField").grp_timepicker()},grappelli.get_app_label=function(e){var t=e.next("a");if(0<t.length){var a=t.attr("href").split("?")[0].split("/");return a[a.length-3]}return!1},grappelli.get_model_name=function(e){var t=e.next("a");if(0<t.length){var a=t.attr("href").split("?")[0].split("/");return a[a.length-2]}return!1},grappelli.get_query_string=function(e){var t=e.next("a");if(0<t.length){var a=t.attr("href").split("/");return pairs=a[a.length-1].replace("?","").split("&"),pairs.join(":")}return!1},grappelli.get_to_field=function(e){var t=e.next("a");if(0<t.length&&-1!==t.attr("href").indexOf("_to_field"))for(var a=t.attr("href").split("/"),r=a[a.length-1].replace("?","").split("&"),n=0;n<r.length;n++)if(v=r[n].split("="),"_to_field"==v[0])return v[1];return!1}}(grp.jQuery),function(n){var t={init:function(t){return t=n.extend({},n.fn.grp_autocomplete_fk.defaults,t),this.each(function(){var e=n(this);e.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),e.next().next()&&"errorlist"!=e.next().next().attr("class")&&"grp-help"!=e.next().next().attr("class")&&e.next().next().remove(),e.next().after(a).after(r(e.attr("id"))),e.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),e.parent().prepend("<input id='"+e.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),t=n.extend({wrapper_autocomplete:e.parent(),input_field:e.prev(),remove_link:e.next().next().hide(),loader:e.next().next().next().hide()},n.fn.grp_autocomplete_fk.defaults,t),i(e,t),l(e,t),e.bind("change focus keyup",function(){i(e,t)}),n("label[for='"+e.attr("id")+"']").each(function(){n(this).attr("for",e.attr("id")+"-autocomplete")})})}};n.fn.grp_autocomplete_fk=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(n.error("Method "+e+" does not exist on jQuery.grp_autocomplete_fk"),!1):t.init.apply(this,arguments)};var a=function(){return n('<div class="grp-loader">loader</div>')},r=function(e){var t=n('<a class="grp-related-remove"></a>');return t.attr("id","remove_"+e),t.attr("href","javascript://"),t.attr("onClick","return removeRelatedObject(this);"),t.hover(function(){n(this).parent().toggleClass("grp-autocomplete-preremove")}),t},l=function(a,r){r.wrapper_autocomplete.find("input:first").bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,source:function(e,t){n.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(e.term)+"&app_label="+grappelli.get_app_label(a)+"&model_name="+grappelli.get_model_name(a)+"&query_string="+grappelli.get_query_string(a)+"&to_field="+grappelli.get_to_field(a),beforeSend:function(e){r.loader.show()},success:function(e){t(n.map(e,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return!1},select:function(e,t){return r.input_field.val(t.item.label),a.val(t.item.value),a.trigger("change"),a.val()?n(r.remove_link).show():n(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(e,t){return t.value?n("<li></li>").data("item.autocomplete",t).append(n("<a></a>").text(t.label)).appendTo(e):n("<li class='ui-state-disabled'></li>").data("item.autocomplete",t).append(n("<span class='error'></span>").text(t.label)).appendTo(e)}},i=function(a,r){n.getJSON(r.lookup_url,{object_id:a.val(),app_label:grappelli.get_app_label(a),model_name:grappelli.get_model_name(a),query_string:grappelli.get_query_string(a),to_field:grappelli.get_to_field(a)},function(t){n.each(t,function(e){r.input_field.val(t[e].label),a.val()?n(r.remove_link).show():n(r.remove_link).hide()})})};n.fn.grp_autocomplete_fk.defaults={autocomplete_lookup_url:"",lookup_url:""}}(grp.jQuery),function(n){var t={init:function(a){return a=n.extend({},n.fn.grp_autocomplete_generic.defaults,a),this.each(function(){var e=n(this);e.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field");var t=n(a.content_type).val()||n(a.content_type).find(":checked").val();t&&e.after(l).after(i(e.attr("id"))).after(o(e.attr("id"),t)),e.parent().wrapInner("<div class='grp-autocomplete-wrapper-fk'></div>"),e.parent().prepend("<input id='"+e.attr("id")+"-autocomplete' type='text' class='vTextField' value='' />"),a=n.extend({wrapper_autocomplete:n(this).parent(),input_field:n(this).prev(),remove_link:e.nextAll("a.grp-related-remove").hide(),loader:e.nextAll("div.grp-loader").hide()},n.fn.grp_autocomplete_generic.defaults,a),t&&s(e,a),p(e,a),e.bind("change focus keyup",function(){s(e,a)}),n(a.content_type).bind("change",function(){r(n(this),a)}),n("label[for='"+e.attr("id")+"']").each(function(){n(this).attr("for",e.attr("id")+"-autocomplete")})})}};n.fn.grp_autocomplete_generic=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(n.error("Method "+e+" does not exist on jQuery.grp_autocomplete_generic"),!1):t.init.apply(this,arguments)};var l=function(){return n('<div class="grp-loader">loader</div>')},i=function(e){var t=n('<a class="grp-related-remove"></a>');return t.attr("id","remove_"+e),t.attr("href","javascript://"),t.attr("onClick","return removeRelatedObject(this);"),t.hover(function(){n(this).parent().toggleClass("grp-autocomplete-preremove")}),t},o=function(e,t){var a=n('<a class="related-lookup"></a>');return a.attr("id","lookup_"+e),a.attr("href",window.ADMIN_URL+MODEL_URL_ARRAY[t].app+"/"+MODEL_URL_ARRAY[t].model+"/?"),a.attr("onClick","return showRelatedObjectLookupPopup(this);"),a},r=function(e,t){var a=n(t.object_id);a.val(""),a.prev().val(""),a.nextAll("a.related-lookup").remove(),a.nextAll("a.grp-related-remove").remove(),a.nextAll("div.grp-loader").remove();var r=n(e).val()||n(e).find(":checked").val();r&&(a.after(l).after(i(a.attr("id"))).after(o(a.attr("id"),r)),t.remove_link=a.nextAll("a.grp-related-remove").hide(),t.loader=a.nextAll("div.grp-loader").hide())},p=function(a,r){r.wrapper_autocomplete.find("input:first").bind("focus",function(){r.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){r.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,source:function(e,t){n.ajax({url:r.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(e.term)+"&app_label="+grappelli.get_app_label(a)+"&model_name="+grappelli.get_model_name(a)+"&query_string="+grappelli.get_query_string(a),beforeSend:function(e){if(!(n(r.content_type).val()||n(r.content_type).find(":checked").val()))return!1;r.loader.show()},success:function(e){t(n.map(e,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){r.loader.hide()}})},focus:function(){return!1},select:function(e,t){return r.input_field.val(t.item.label),a.val(t.item.value),a.trigger("change"),a.val()?n(r.remove_link).show():n(r.remove_link).hide(),!1}}).data("ui-autocomplete")._renderItem=function(e,t){return t.value?n("<li></li>").data("item.autocomplete",t).append(n("<a></a>").text(t.label)).appendTo(e):n("<li class='ui-state-disabled'></li>").data("item.autocomplete",t).append(n("<span class='error'></span>").text(t.label)).appendTo(e)}},s=function(a,r){n.getJSON(r.lookup_url,{object_id:a.val(),app_label:grappelli.get_app_label(a),model_name:grappelli.get_model_name(a)},function(t){n.each(t,function(e){r.input_field.val(t[e].label),a.val()?n(r.remove_link).show():n(r.remove_link).hide()})})};n.fn.grp_autocomplete_generic.defaults={autocomplete_lookup_url:"",lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(o){var t={init:function(t){return t=o.extend({},o.fn.grp_autocomplete_m2m.defaults,t),this.each(function(){var e=o(this);e.attr({tabindex:"-1",readonly:"readonly"}).addClass("grp-autocomplete-hidden-field"),e.next().after(a).after(r(e.attr("id"))),e.parent().wrapInner("<div class='grp-autocomplete-wrapper-m2m'></div>"),e.parent().prepend("<ul class='grp-repr'><li class='grp-search'><input id='"+e.attr("id")+"-autocomplete' type='text' class='vTextField' value='' /></li></ul>"),t=o.extend({wrapper_autocomplete:e.parent(),wrapper_repr:e.parent().find("ul.grp-repr"),wrapper_search:e.parent().find("li.grp-search"),remove_link:e.next().next().hide(),loader:e.next().next().next().hide()},o.fn.grp_autocomplete_m2m.defaults,t),e.parent().find("ul.errorlist")&&e.parent().find("ul.errorlist").detach().appendTo(e.parent().parent()),e.parent().find("p.grp-help")&&e.parent().find("p.grp-help").detach().appendTo(e.parent().parent()),l(e,t),n(e,t),e.bind("change focus keyup",function(){l(e,t)}),o("label[for='"+e.attr("id")+"']").each(function(){o(this).attr("for",e.attr("id")+"-autocomplete")}),t.wrapper_autocomplete.bind("click",function(e){o(e.target).hasClass("related-lookup")||o(e.target).hasClass("grp-related-remove")||t.wrapper_search.find("input:first").focus()})})}};o.fn.grp_autocomplete_m2m=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(o.error("Method "+e+" does not exist on jQuery.grp_autocomplete_m2m"),!1):t.init.apply(this,arguments)};var a=function(){return o('<div class="grp-loader">loader</div>')},r=function(e){var t=o('<a class="grp-related-remove"></a>');return t.attr("id","remove_"+e),t.attr("href","javascript://"),t.attr("onClick","return removeRelatedObject(this);"),t.hover(function(){o(this).parent().toggleClass("grp-autocomplete-preremove")}),t},p=function(l,e,i){var t=o('<li class="grp-repr"></li>'),a=o('<a class="grp-m2m-remove" href="javascript://"></a>').text(e);t.append(a),t.insertBefore(i.wrapper_search),a.bind("click",function(e){var t,a,r,n=o(this).parent().parent().children("li").index(o(this).parent());a=n,r=[],(t=l).val()&&(r=t.val().split(",")),r.splice(a,1),t.val(r.join(",")),t.trigger("change"),r.join(","),o(this).parent().remove(),l.val()?o(i.remove_link).show():o(i.remove_link).hide(),e.stopPropagation()}),a.hover(function(){o(this).parent().toggleClass("grp-autocomplete-preremove")})},n=function(l,i){i.wrapper_search.find("input:first").bind("keydown",function(e){e.keyCode===o.ui.keyCode.TAB&&o(this).data("uiAutocomplete").menu.active&&e.preventDefault()}).bind("focus",function(){i.wrapper_autocomplete.addClass("grp-state-focus")}).bind("blur",function(){i.wrapper_autocomplete.removeClass("grp-state-focus")}).autocomplete({minLength:1,autoFocus:!0,delay:1e3,position:{my:"left top",at:"left bottom",of:i.wrapper_autocomplete},open:function(e,t){o(".ui-menu").width(i.wrapper_autocomplete.outerWidth()-6)},source:function(e,t){o.ajax({url:i.autocomplete_lookup_url,dataType:"json",data:"term="+encodeURIComponent(e.term)+"&app_label="+grappelli.get_app_label(l)+"&model_name="+grappelli.get_model_name(l)+"&query_string="+grappelli.get_query_string(l),beforeSend:function(e){i.loader.show()},success:function(e){t(o.map(e,function(e){return{label:e.label,value:e.value}}))},complete:function(e,t){i.loader.hide()}})},focus:function(){return!1},select:function(e,t){var a,r,n;return p(l,t.item.label,i),a=l,r=t.item.value,n=[],a.val()&&(n=a.val().split(",")),n.push(r),a.val(n.join(",")),a.trigger("change"),n.join(","),l.val()?o(i.remove_link).show():o(i.remove_link).hide(),o(this).val("").focus(),!1}}).data("ui-autocomplete")._renderItem=function(e,t){return t.value?o("<li></li>").data("item.autocomplete",t).append(o("<a></a>").text(t.label)).appendTo(e):o("<li class='ui-state-disabled'></li>").data("item.autocomplete",t).append(o("<span class='error'></span>").text(t.label)).appendTo(e)}},l=function(a,r){o.getJSON(r.lookup_url,{object_id:a.val(),app_label:grappelli.get_app_label(a),model_name:grappelli.get_model_name(a)},function(t){r.wrapper_repr.find("li.grp-repr").remove(),r.wrapper_search.find("input").val(""),o.each(t,function(e){t[e].value&&p(a,t[e].label,r)}),a.val()?o(r.remove_link).show():o(r.remove_link).hide()})}}(grp.jQuery),function(a){a.fn.grp_collapsible_group=function(e){return e=a.extend({open_handler_slctr:".grp-open-handler",close_handler_slctr:".grp-close-handler",collapsible_container_slctr:".grp-collapse",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_open:function(){},on_close:function(){}},e),this.each(function(){t(a(this),e)})};var t=function(e,t){t.on_init(e,t),r(e,t)},r=function(e,t){n(e,t),l(e,t)},n=function(e,t){e.find(t.open_handler_slctr).each(function(){a(this).click(function(){t.on_open(e,t),e.find(t.collapsible_container_slctr).removeClass(t.closed_css).addClass(t.open_css),e.removeClass(t.closed_css).addClass(t.open_css)})})},l=function(e,t){e.find(t.close_handler_slctr).each(function(){a(this).click(function(){t.on_close(e,t),e.find(t.collapsible_container_slctr).removeClass(t.open_css).addClass(t.closed_css)})})}}(grp.jQuery),function(a){a.fn.grp_collapsible=function(e){var t=a.extend({toggle_handler_slctr:".grp-collapse-handler:first",closed_css:"grp-closed",open_css:"grp-open",on_init:function(){},on_toggle:function(){}},e);return this.each(function(){r(a(this),t)})};var r=function(e,t){t.on_init(e,t),n(e,t)},n=function(e,t){l(e,t)},l=function(e,t){e.children(t.toggle_handler_slctr).click(function(){e.toggleClass(t.closed_css).toggleClass(t.open_css),t.on_toggle(e,t)})}}(grp.jQuery),function(s){s.fn.grp_inline=function(t){return t=s.extend({prefix:"form",addText:"add another",deleteText:"remove",addCssClass:"grp-add-handler",removeCssClass:"grp-remove-handler",deleteCssClass:"grp-delete-handler",emptyCssClass:"grp-empty-form",formCssClass:"grp-dynamic-form",predeleteCssClass:"grp-predelete",onBeforeInit:function(e){},onBeforeAdded:function(e){},onBeforeRemoved:function(e){},onBeforeDeleted:function(e){},onAfterInit:function(e){},onAfterAdded:function(e){},onAfterRemoved:function(e){},onAfterDeleted:function(e){}},t),this.each(function(){var e=s(this);e.find("#id_"+t.prefix+"-TOTAL_FORMS").attr("autocomplete","off"),initInlineForms(e,t),initAddButtons(e,t),addButtonHandler(e.find("a."+t.addCssClass),t),removeButtonHandler(e.find("a."+t.removeCssClass),t),deleteButtonHandler(e.find("a."+t.deleteCssClass),t)})},getFormIndex=function(e,t,a){var r=e.find("[id^='id_"+t.prefix+"']").attr("id");return r?parseInt(a.exec(r)[1],10):-1},updateFormIndex=function(e,t,o,p){e.find(":input,span,table,iframe,label,a,ul,p,img,div").each(function(){var e=s(this),t=e.attr("id"),a=e.attr("name"),r=e.attr("for"),n=e.attr("href"),l=e.attr("class"),i=e.attr("onclick");t&&e.attr("id",t.replace(o,p)),a&&e.attr("name",a.replace(o,p)),r&&e.attr("for",r.replace(o,p)),n&&e.attr("href",n.replace(o,p)),l&&e.attr("class",l.replace(o,p)),i&&e.attr("onclick",i.replace(o,p))}),e.find(".prepopulated_field").each(function(){var e=s(this).data("dependency_ids")||[],a=[];s.each(e,function(e,t){a.push(t.replace(o,p))}),s(this).data("dependency_ids",a)})};initInlineForms=function(e,t){e.find("div.grp-module").each(function(){var e=s(this);t.onBeforeInit(e),""!==e.attr("id")&&e.not("."+t.emptyCssClass).not(".grp-table").not(".grp-thead").not(".add-item").addClass(t.formCssClass),e.find("li.grp-delete-handler-container input").each(function(){s(this).is(":checked")&&e.hasClass("has_original")&&e.toggleClass(t.predeleteCssClass)}),t.onAfterInit(e)})},initAddButtons=function(e,t){var a=e.find("#id_"+t.prefix+"-TOTAL_FORMS"),r=e.find("#id_"+t.prefix+"-MAX_NUM_FORMS");e.find("a."+t.addCssClass);""!==r.val()&&r.val()-a.val()<=0&&hideAddButtons(e,t)},addButtonHandler=function(i,o){i.bind("click",function(){var e=i.parents(".grp-group"),t=e.find("#id_"+o.prefix+"-TOTAL_FORMS"),a=e.find("#id_"+o.prefix+"-MAX_NUM_FORMS"),r=(e.find("a."+o.addCssClass),e.find("#"+o.prefix+"-empty"));o.onBeforeAdded(e);var n=parseInt(t.val(),10),l=r.clone(!0);l.removeClass(o.emptyCssClass).attr("id",r.attr("id").replace("-empty",n));updateFormIndex(l,o,/__prefix__/g,n),l.insertBefore(r).addClass(o.formCssClass),t.val(n+1),0!==a.val()&&""!==a.val()&&a.val()-t.val()<=0&&hideAddButtons(e,o),l.find(".prepopulated_field").each(function(){var e=s(this).data("dependency_ids")||[];s(this).prepopulate(e,s(this).attr("maxlength"))}),o.onAfterAdded(l)})},removeButtonHandler=function(i,o){i.bind("click",function(){var e=i.parents(".grp-group"),t=s(this).parents("."+o.formCssClass).first(),a=e.find("#id_"+o.prefix+"-TOTAL_FORMS"),r=e.find("#id_"+o.prefix+"-MAX_NUM_FORMS"),n=/-(\d+)-/,l=getFormIndex(t,o,n);o.onBeforeRemoved(t),t.remove(),a.val(parseInt(a.val(),10)-1),0!==r.val()&&0<r.val()-a.val()&&showAddButtons(e,o),e.find("."+o.formCssClass).each(function(){var e=s(this),t=getFormIndex(e,o,n);l<t&&updateFormIndex(e,o,n,"-"+(t-1)+"-")}),o.onAfterRemoved(e)})},deleteButtonHandler=function(e,a){e.bind("click",function(){var e=s(this).prev(),t=s(this).parents("."+a.formCssClass).first();a.onBeforeDeleted(t),t.hasClass("has_original")&&(t.toggleClass(a.predeleteCssClass),e.prop("checked")?e.removeAttr("checked"):e.prop("checked",!0)),a.onAfterDeleted(t)})},hideAddButtons=function(e,t){var a=e.find("a."+t.addCssClass);a.hide().parents(".grp-add-item").hide(),a.closest(".grp-module.grp-transparent").hide()},showAddButtons=function(e,t){var a=e.find("a."+t.addCssClass);a.show().parents(".grp-add-item").show(),a.closest(".grp-module.grp-transparent").show()}}(grp.jQuery),function(r){var t={init:function(a){return a=r.extend({},r.fn.grp_related_fk.defaults,a),this.each(function(){var e=r(this),t=e.parent();t.find("a.related-lookup").next().is("strong")&&(t.find("a.related-lookup").get(0).nextSibling.nodeValue="",t.find("a.related-lookup").next("strong").remove()),t.find("a.related-lookup").after(a.placeholder),e.addClass("grp-has-related-lookup"),n(e,a),e.bind("change focus keyup",function(){n(e,a)})})}};r.fn.grp_related_fk=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(r.error("Method "+e+" does not exist on jQuery.grp_related_fk"),!1):t.init.apply(this,arguments)};var n=function(e,t){var a=e.parent().find(".grp-placeholder-related-fk");r.getJSON(t.lookup_url,{object_id:e.val(),app_label:grappelli.get_app_label(e),model_name:grappelli.get_model_name(e),query_string:grappelli.get_query_string(e),to_field:grappelli.get_to_field(e)},function(e){""===e[0].label?a.hide():a.show(),e[0].safe?a.html(r('<span class="grp-placeholder-label"></span>').html(e[0].label+"‎")):a.html(r('<span class="grp-placeholder-label"></span>').text(e[0].label+"‎"))})};r.fn.grp_related_fk.defaults={placeholder:'<div class="grp-placeholder-related-fk"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(n){var t={init:function(a){return a=n.extend({},n.fn.grp_related_generic.defaults,a),this.each(function(){var e=n(this),t=n(a.content_type).val()||n(a.content_type).find(":checked").val();t&&e.after(a.placeholder).after(l(e.attr("id"),t)),e.addClass("grp-has-related-lookup"),t&&i(e,a),e.bind("change focus keyup",function(){i(e,a)}),n(a.content_type).bind("change",function(){r(n(this),a)})})}};n.fn.grp_related_generic=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(n.error("Method "+e+" does not exist on jQuery.grp_related_generic"),!1):t.init.apply(this,arguments)};var l=function(e,t){var a=n('<a class="related-lookup"></a>');return a.attr("id","lookup_"+e),a.attr("href",window.ADMIN_URL+MODEL_URL_ARRAY[t].app+"/"+MODEL_URL_ARRAY[t].model+"/?"),a.attr("onClick","return showRelatedObjectLookupPopup(this);"),a},r=function(e,t){var a=n(t.object_id);a.val(""),a.parent().find("a.related-lookup").remove(),a.parent().find(".grp-placeholder-related-generic").remove();var r=n(e).val()||n(e).find(":checked").val();r&&a.after(t.placeholder).after(l(a.attr("id"),r))},i=function(e,t){var a=e.next().next();n.getJSON(t.lookup_url,{object_id:e.val(),app_label:grappelli.get_app_label(e),model_name:grappelli.get_model_name(e),query_string:grappelli.get_query_string(e)},function(e){""===e[0].label?a.hide():a.show(),e[0].safe?a.html(n('<span class="grp-placeholder-label"></span>').html(e[0].label+"‎")):a.html(n('<span class="grp-placeholder-label"></span>').text(e[0].label+"‎"))})};n.fn.grp_related_generic.defaults={placeholder:'<div class="grp-placeholder-related-generic" style="display:none"></div>',repr_max_length:30,lookup_url:"",content_type:"",object_id:""}}(grp.jQuery),function(r){var t={init:function(t){return t=r.extend({},r.fn.grp_related_m2m.defaults,t),this.each(function(){var e=r(this);e.parent().find("a.related-lookup").after(t.placeholder),e.next().addClass("grp-m2m"),e.addClass("grp-has-related-lookup"),a(e,t),e.bind("change focus keyup",function(){a(e,t)})})}};r.fn.grp_related_m2m=function(e){return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(r.error("Method "+e+" does not exist on jQuery.grp_related_m2m"),!1):t.init.apply(this,arguments)};var a=function(e,t){r.getJSON(t.lookup_url,{object_id:e.val(),app_label:grappelli.get_app_label(e),model_name:grappelli.get_model_name(e),query_string:grappelli.get_query_string(e)},function(a){values=r.map(a,function(e,t){return a.length!==t+1||e.safe?a.length===t+1&&e.safe?r('<span class="grp-placeholder-label"></span>').html(e.label+"‎"):e.safe?r('<span class="grp-placeholder-label"></span>').html(e.label+"‎").append(r('<span class="grp-separator"></span>')):r('<span class="grp-placeholder-label"></span>').text(e.label+"‎").append(r('<span class="grp-separator"></span>')):r('<span class="grp-placeholder-label"></span>').text(e.label+"‎")}),""===values?e.parent().find(".grp-placeholder-related-m2m").hide():e.parent().find(".grp-placeholder-related-m2m").show(),e.parent().find(".grp-placeholder-related-m2m").html(values)})};r.fn.grp_related_m2m.defaults={placeholder:'<div class="grp-placeholder-related-m2m"></div>',repr_max_length:30,lookup_url:""}}(grp.jQuery),function(i){i.widget("ui.grp_timepicker",{options:{template:'<div id="ui-timepicker" class="module" style="position: absolute; display: none;"></div>',timepicker_selector:"#ui-timepicker",offset:{top:0},default_time_list:["now","00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],time_list:[]},_create:function(){var a=this;i(document).mousedown(function(e){if(a.timepicker.is(":visible")){var t=i(e.target);t[0].id==a.timepicker[0].id||0!==t.parents(a.options.timepicker_selector).length||t.hasClass("hasTimepicker")||t.hasClass("ui-timepicker-trigger")||a.timepicker.hide()}}),i(document).keyup(function(e){27==e.keyCode&&a.timepicker.hide()}),0===i(this.options.timepicker_selector).size()&&i(this.options.template).appendTo("body"),this.timepicker=i(this.options.timepicker_selector),this.timepicker.hide(),this.element.addClass("hasTimepicker"),this.button=i('<button type="button" class="ui-timepicker-trigger"></button>'),this.element.after(this.button),this.element.prop("disabled")?this.button.prop("disabled",!0):this.button.click(function(){a._toggleTimepicker()})},_toggleTimepicker:function(){this.timepicker.is(":visible")?this.timepicker.hide():(this.element.focus(),this._generateTimepickerContents(),this._showTimepicker())},_generateTimepickerContents:function(){var e=this,t="<ul>";0===this.options.time_list.length&&(this.options.time_list=this.options.default_time_list);for(var a=0;a<this.options.time_list.length;a++)if("now"==this.options.time_list[a]){var r=new Date,n=r.getHours(),l=r.getMinutes();t+='<li class="ui-state-active row">'+(n=n<10?"0"+n:n)+":"+(l=l<10?"0"+l:l)+"</li>"}else t+='<li class="ui-state-default row">'+this.options.time_list[a]+"</li>";t+="</ul>",this.timepicker.html(t),this.timepicker.find("li").click(function(){i(this).parent().children("li").removeClass("ui-state-active"),i(this).addClass("ui-state-active"),e.element.val(i(this).html()),e.timepicker.hide()})},_showTimepicker:function(){var e=document.documentElement.clientHeight,t=document.documentElement.scrollTop||document.body.scrollTop,a=this.element.outerHeight(),r=this.timepicker.outerHeight()+a,n=this.element.offset().top,l=this.element.offset().left;if(n-t+r+60<e){var i=n+a;this.timepicker.css("left",l+"px").css("top",i+"px")}else{var o=n-r+a;this.timepicker.css("left",l+"px").css("top",o+"px")}this.timepicker.show()},destroy:function(){i.Widget.prototype.destroy.apply(this,arguments)}})}(grp.jQuery);